import{r as e,h as t}from"./p-29cdcf48.js";const n=(e,t)=>t.split(".").reduce((function(t,i){const s=i.match(/\[(.*?)\]$/);if(s){const e=s[1];const n=i.replace(s[0],"");if(parseInt(e,10)>-1){const r=parseInt(e,10);if(Array.isArray(t[n])&&t[n][r]){return t[n][r]}else{return undefined}}else{return r(t[n],e)}}else{if(t&&t[i]!==undefined){if(t[i]!==null&&t[i].$use){return n(e,t[i].$use)}else{return t[i]}}else{return undefined}}}),e);function r(e,t){const n=t.split("(");if(!n||n.length!==2)return undefined;let r;const s=n[0];const o=n[1].replace(")","").split(",").map((e=>e.trim()));switch(s){case"findBy":const t=o[0];let n;if(i(o[1])){n=parseFloat(o[1])}else{n=o[1].replace(/'/g,"")}r=e.find((e=>e[t]===n));break;default:r=undefined}return r}function i(e){return!isNaN(parseFloat(e))}function s(e){let t={};if(Array.isArray(e)){t=e.map(s)}else if(typeof e==="object"){for(const n in e){if(e.hasOwnProperty(n)){const r=e[n];if(r!=null&&typeof r==="object"){if(r instanceof Date){t[n]=new Date(r.getTime())}else if(typeof Blob!=="undefined"&&r instanceof Blob){t[n]=new Blob([r],{type:r.type})}else{t[n]=s(r)}}else{t[n]=r}}}}else{t=e}return t}function o(e="i"){return`${e}${Math.random().toString(36).substr(2,8)}`}function a(e,t,n){return n.indexOf(e)===t}function c(e,t,n={},r=false){const i=t.split(".");let o=e;const a=i.length-1;i.forEach(((e,t)=>{if(!o.hasOwnProperty(e)||o[e]==null){if(t===a){o[e]=n}else{o[e]={}}}else if(t===a){if(typeof o[e]==="object"&&!Array.isArray(o[e])){if(r){o[e]=s(n)}else{o[e]=Object.assign(o[e],s(n))}}else{o[e]=n}}o=o[e]}))}function u(e,t,r){const i=n(e,t);return i!==undefined?i:r}function f(e,t,n,r=false){if(Array.isArray(e)){e=e.join(".")}c(n,e,t,r)}class l extends Error{constructor(e,t,n){t=t||"UNKNOWN_ERROR";n=u(n,"rootCause",n);super(t);this.operation=e;this.name="OperationError";this.rootCause=n;Object.setPrototypeOf(this,l.prototype);this.stack=u(n,"stack",(new Error).stack)}}const p=e=>t=>e.reduce(((e,n)=>e.then(n).catch((e=>{if(e.name==="OperationError"){return Promise.reject(e)}else{const e=`IPipeableFn did not reject with an OperationError \n Operation Stack: \n ${t.stack.toString()}`;const n=new l("pipeline execution error",e);n.operationStack=t.stack.serialize();return Promise.reject(n)}}))),Promise.resolve(t));function h(e,t=[]){return t.map((t=>t[e]))}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var d=function(e,t){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return d(e,t)};function m(e,t){d(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var g=function(){g=Object.assign||function e(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s))t[s]=n[s]}return t};return g.apply(this,arguments)};function b(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n}function w(e){return Object.keys(e).some((function(t){var n=e[t];if(!n){return false}if(n&&n.toParam){n=n.toParam()}var r=n.constructor.name;switch(r){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function y(e){var t={};Object.keys(e).forEach((function(n){var r,i;var s=e[n];if(s&&s.toParam){s=s.toParam()}if(!s&&s!==0&&typeof s!=="boolean"&&typeof s!=="string"){return}var o=s.constructor.name;var a;switch(o){case"Array":var c=(i=(r=s[0])===null||r===void 0?void 0:r.constructor)===null||i===void 0?void 0:i.name;a=c==="Array"?s:c==="Object"?JSON.stringify(s):s.join(",");break;case"Object":a=JSON.stringify(s);break;case"Date":a=s.valueOf();break;case"Function":a=null;break;case"Boolean":a=s+"";break;default:a=s;break}if(a||a===0||typeof a==="string"||Array.isArray(a)){t[n]=a}}));return t}function v(e,t){if(Array.isArray(t)&&t[0]&&Array.isArray(t[0])){return t.map((function(t){return v(e,t)})).join("&")}return encodeURIComponent(e)+"="+encodeURIComponent(t)}function O(e){var t=y(e);return Object.keys(t).map((function(e){return v(e,t[e])})).join("&")}function k(e,t){var n=w(e)||t;var r=y(e);if(n){var i=new FormData;Object.keys(r).forEach((function(e){if(typeof Blob!=="undefined"&&r[e]instanceof Blob){var t=r["fileName"]||r[e].name||e;i.append(e,r[e],t)}else if(r[e].constructor&&r[e].constructor.name==="ReadStream"&&Number.isInteger(r["dataSize"])){i.append(e,r[e],{knownLength:r["dataSize"]})}else{i.append(e,r[e])}}));return i}else{return O(e)}}var S=function(){function e(e,t,n,r,i){e=e||"UNKNOWN_ERROR";t=t||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=t==="UNKNOWN_ERROR_CODE"?e:t+": "+e;this.originalMessage=e;this.code=t;this.response=n;this.url=r;this.options=i}return e}();S.prototype=Object.create(Error.prototype);S.prototype.constructor=S;function D(e){if(console&&console.warn){console.warn.apply(console,[e])}}var $="@esri/arcgis-rest-js";var E={httpMethod:"POST",params:{f:"json"}};var A=function(e){m(t,e);function t(t,n,r,i,s){if(t===void 0){t="AUTHENTICATION_ERROR"}if(n===void 0){n="AUTHENTICATION_ERROR_CODE"}var o=e.call(this,t,n,r,i,s)||this;o.name="ArcGISAuthError";o.message=n==="AUTHENTICATION_ERROR_CODE"?t:n+": "+t;return o}t.prototype.retry=function(e,t){var n=this;if(t===void 0){t=3}var r=0;var i=function(s,o){e(n.url,n.options).then((function(e){var t=g(g({},n.options),{authentication:e});r=r+1;return j(n.url,t)})).then((function(e){s(e)})).catch((function(e){if(e.name==="ArcGISAuthError"&&r<t){i(s,o)}else if(e.name==="ArcGISAuthError"&&r>=t){o(n)}else{o(e)}}))};return new Promise((function(e,t){i(e,t)}))};return t}(S);function x(e,t,n,r,i){if(e.code>=400){var s=e.message,o=e.code;throw new S(s,o,e,t,r)}if(e.error){var a=e.error,s=a.message,o=a.code,c=a.messageCode;var u=c||o||"UNKNOWN_ERROR_CODE";if(o===498||o===499||c==="GWM_0003"||o===400&&s==="Unable to generate token."){if(i){throw i}else{throw new A(s,u,e,t,r)}}throw new S(s,u,e,t,r)}if(e.status==="failed"||e.status==="failure"){var s=void 0;var o="UNKNOWN_ERROR_CODE";try{s=JSON.parse(e.statusMessage).message;o=JSON.parse(e.statusMessage).code}catch(t){s=e.statusMessage||e.message}throw new S(s,o,e,t,r)}return e}function j(e,t){if(t===void 0){t={params:{f:"json"}}}var n=g(g(g({httpMethod:"POST"},E),t),{params:g(g({},E.params),t.params),headers:g(g({},E.headers),t.headers)});var r=[];var i=[];if(!n.fetch&&typeof fetch!=="undefined"){n.fetch=fetch.bind(Function("return this")())}else{r.push("`fetch`");i.push("`node-fetch`")}if(typeof Promise==="undefined"){r.push("`Promise`");i.push("`es6-promise`")}if(typeof FormData==="undefined"){r.push("`FormData`");i.push("`isomorphic-form-data`")}if(!n.fetch||typeof Promise==="undefined"||typeof FormData==="undefined"){throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+r.join(", ")+". We recommend installing the "+i.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.")}var s=n.httpMethod,o=n.authentication,a=n.rawResponse;var c=g({f:"json"},n.params);var u=null;var f={method:s,credentials:n.credentials||"same-origin"};if(n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1){f.credentials="include"}return(o?o.getToken(e,{fetch:n.fetch}).catch((function(t){t.url=e;t.options=n;u=t;return Promise.resolve("")})):Promise.resolve("")).then((function(t){if(t.length){c.token=t}if(o&&o.getDomainCredentials){f.credentials=o.getDomainCredentials(e)}var r={};if(f.method==="GET"){if(c.token&&n.hideToken&&typeof window==="undefined"){r["X-Esri-Authorization"]="Bearer "+c.token;delete c.token}var i=O(c);var s=i===""?e:e+"?"+O(c);if(n.maxUrlLength&&s.length>n.maxUrlLength||c.token&&n.hideToken){f.method="POST";if(t.length&&n.hideToken){c.token=t;delete r["X-Esri-Authorization"]}}else{e=s}}var a=new RegExp("/items/.+/updateResources").test(e);if(f.method==="POST"){f.body=k(c,a)}f.headers=g(g({},r),n.headers);if(typeof window==="undefined"&&!f.headers.referer){f.headers.referer=$}if(!w(c)&&!a){f.headers["Content-Type"]="application/x-www-form-urlencoded"}return n.fetch(e,f)})).then((function(t){if(!t.ok){var r=t.status,i=t.statusText;throw new S(i,"HTTP "+r,t,e,n)}if(a){return t}switch(c.f){case"json":return t.json();case"geojson":return t.json();case"html":return t.text();case"text":return t.text();default:return t.blob()}})).then((function(t){if((c.f==="json"||c.f==="geojson")&&!a){var r=x(t,e,c,n,u);if(u){var i=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];n.authentication.federatedServers[i]={token:[],expires:new Date(Date.now()+86400*1e3)};u=null}return r}else{return t}}))}function T(e,t,n){var r=["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"];var i=g(g({params:{}},n),e);i.params=t.reduce((function(t,n){if(e[n]||typeof e[n]==="boolean"){t[n]=e[n]}return t}),i.params);return r.reduce((function(e,t){if(i[t]){e[t]=i[t]}return e}),{})}function N(e){if(typeof e!=="string"){return e}e=e.trim();if(e[e.length-1]==="/"){e=e.slice(0,-1)}return e}function R(e){var t=e.split("="),n=t[0],r=t[1];return{key:decodeURIComponent(n),value:decodeURIComponent(r)}}function P(e){return e.replace(/^#/,"").split("&").reduce((function(e,t){var n=R(t),r=n.key,i=n.value;e[r]=i;return e}),{})}function q(e,t){var n=t;n.rawResponse=false;return j(e,n).then((function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(e.expires_in*1e3-1e3)),ssl:e.ssl===true};if(e.refresh_token){t.refreshToken=e.refresh_token}return t}))}function I(e,t){var n=t;if(typeof window!=="undefined"&&window.location&&window.location.host){n.params.referer=window.location.host}else{n.params.referer=$}return j(e,n)}var M=/^https?:\/\/(\S+)\.arcgis\.com.+/;function _(e){return M.test(e)}function C(e){if(!M.test(e)){return e}switch(U(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}function U(e){if(!M.test(e)){return null}var t=e.match(M);var n=t[1].split(".").pop();if(n.includes("dev")){return"dev"}if(n.includes("qa")){return"qa"}return"production"}function G(e,t){var n=N(C(t)).replace(/https?:\/\//,"");var r=N(e).replace(/https?:\/\//,"");return new RegExp(r,"i").test(n)}function W(e,t){var n=_(e);var r=_(t);var i=U(e);var s=U(t);if(n&&r&&i===s){return true}return false}function F(e,t,n){if(n===void 0){n="https://www.arcgis.com/sharing/rest"}var r=n+"/oauth2/validateAppAccess";var i={method:"POST",params:{f:"json",client_id:t,token:e}};return j(r,i)}function L(){var e={promise:null,resolve:null,reject:null};e.promise=new Promise((function(t,n){e.resolve=t;e.reject=n}));return e}var H=function(){function e(e){this.clientId=e.clientId;this._refreshToken=e.refreshToken;this._refreshTokenExpires=e.refreshTokenExpires;this.username=e.username;this.password=e.password;this._token=e.token;this._tokenExpires=e.tokenExpires;this.portal=e.portal?N(e.portal):"https://www.arcgis.com/sharing/rest";this.ssl=e.ssl;this.provider=e.provider||"arcgis";this.tokenDuration=e.tokenDuration||20160;this.redirectUri=e.redirectUri;this.refreshTokenTTL=e.refreshTokenTTL||20160;this.server=e.server;this.federatedServers={};this.trustedDomains=[];if(e.server){var t=this.getServerRootUrl(e.server);this.federatedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"trustedServers",{get:function(){console.log("DEPRECATED: use federatedServers instead");return this.federatedServers},enumerable:false,configurable:true});e.beginOAuth2=function(t,n){if(n===void 0){n=window}if(t.duration){console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead")}var r=g({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:true,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",state:t.clientId,locale:""},t),i=r.portal,s=r.provider,o=r.clientId,a=r.expiration,c=r.redirectUri,u=r.popup,f=r.popupWindowFeatures,l=r.state,p=r.locale,h=r.params;var d;if(s==="arcgis"){d=i+"/oauth2/authorize?client_id="+o+"&response_type=token&expiration="+(t.duration||a)+"&redirect_uri="+encodeURIComponent(c)+"&state="+l+"&locale="+p}else{d=i+"/oauth2/social/authorize?client_id="+o+"&socialLoginProviderName="+s+"&autoAccountCreateForSocial=true&response_type=token&expiration="+(t.duration||a)+"&redirect_uri="+encodeURIComponent(c)+"&state="+l+"&locale="+p}if(h){d=d+"&"+O(h)}if(!u){n.location.href=d;return undefined}var m=L();n["__ESRI_REST_AUTH_HANDLER_"+o]=function(t,n){if(t){var r=JSON.parse(t);m.reject(new A(r.errorMessage,r.error));return}if(n){var s=JSON.parse(n);m.resolve(new e({clientId:o,portal:i,ssl:s.ssl,token:s.token,tokenExpires:new Date(s.expires),username:s.username}))}};n.open(d,"oauth-window",f);return m.promise};e.completeOAuth2=function(t,n){if(n===void 0){n=window}var r=g({portal:"https://www.arcgis.com/sharing/rest",popup:true},t),i=r.portal,s=r.clientId,o=r.popup;function a(t,r){try{var a=void 0;var c="__ESRI_REST_AUTH_HANDLER_"+s;if(o){if(n.opener){if(n.opener.parent&&n.opener.parent[c]){a=n.opener.parent[c]}else if(n.opener&&n.opener[c]){a=n.opener[c]}}else{if(n!==n.parent&&n.parent&&n.parent[c]){a=n.parent[c]}}if(a){a(t?JSON.stringify(t):undefined,JSON.stringify(r));n.close();return undefined}}}catch(e){throw new A('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(t){throw new A(t.errorMessage,t.error)}return new e({clientId:s,portal:i,ssl:r.ssl,token:r.token,tokenExpires:r.expires,username:r.username})}var c=P(n.location.hash);if(!c.access_token){var u=void 0;var f="Unknown error";if(c.error){u=c.error;f=c.error_description}return a({error:u,errorMessage:f})}var l=c.access_token;var p=new Date(Date.now()+parseInt(c.expires_in,10)*1e3-60*1e3);var h=c.username;var d=c.ssl==="true";return a(undefined,{token:l,expires:p,ssl:d,username:h})};e.fromParent=function(t,n){if(!n&&window){n=window}var r;return new Promise((function(i,s){r=function(t){if(t.source===n.parent&&t.data){try{return i(e.parentMessageHandler(t))}catch(e){return s(e)}}};n.addEventListener("message",r,false);n.parent.postMessage({type:"arcgis:auth:requestCredential"},t)})).then((function(e){n.removeEventListener("message",r,false);return e}))};e.authorize=function(e,t){if(e.duration){console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead")}var n=g({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),r=n.portal,i=n.clientId,s=n.expiration,o=n.redirectUri;t.writeHead(301,{Location:r+"/oauth2/authorize?client_id="+i+"&expiration="+(e.duration||s)+"&response_type=code&redirect_uri="+encodeURIComponent(o)});t.end()};e.exchangeAuthorizationCode=function(t,n){var r=g({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:20160},t),i=r.portal,s=r.clientId,o=r.redirectUri,a=r.refreshTokenTTL;return q(i+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:s,redirect_uri:o,code:n}}).then((function(t){return new e({clientId:s,portal:i,ssl:t.ssl,redirectUri:o,refreshToken:t.refreshToken,refreshTokenTTL:a,refreshTokenExpires:new Date(Date.now()+(a-1)*60*1e3),token:t.token,tokenExpires:t.expires,username:t.username})}))};e.deserialize=function(t){var n=JSON.parse(t);return new e({clientId:n.clientId,refreshToken:n.refreshToken,refreshTokenExpires:new Date(n.refreshTokenExpires),username:n.username,password:n.password,token:n.token,tokenExpires:new Date(n.tokenExpires),portal:n.portal,ssl:n.ssl,tokenDuration:n.tokenDuration,redirectUri:n.redirectUri,refreshTokenTTL:n.refreshTokenTTL})};e.fromCredential=function(t){var n=typeof t.ssl!=="undefined"?t.ssl:true;var r=t.expires||Date.now()+72e5;return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:n,token:t.token,username:t.userId,tokenExpires:new Date(r)})};e.parentMessageHandler=function(t){if(t.data.type==="arcgis:auth:credential"){return e.fromCredential(t.data.credential)}if(t.data.type==="arcgis:auth:error"){var n=new Error(t.data.error.message);n.name=t.data.error.name;throw n}else{throw new Error("Unknown message type.")}};e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}};e.prototype.getUser=function(e){var t=this;if(this._pendingUserRequest){return this._pendingUserRequest}else if(this._user){return Promise.resolve(this._user)}else{var n=this.portal+"/community/self";var r=g(g({httpMethod:"GET",authentication:this},e),{rawResponse:false});this._pendingUserRequest=j(n,r).then((function(e){t._user=e;t._pendingUserRequest=null;return e}));return this._pendingUserRequest}};e.prototype.getPortal=function(e){var t=this;if(this._pendingPortalRequest){return this._pendingPortalRequest}else if(this._portalInfo){return Promise.resolve(this._portalInfo)}else{var n=this.portal+"/portals/self";var r=g(g({httpMethod:"GET",authentication:this},e),{rawResponse:false});this._pendingPortalRequest=j(n,r).then((function(e){t._portalInfo=e;t._pendingPortalRequest=null;return e}));return this._pendingPortalRequest}};e.prototype.getUsername=function(){if(this.username){return Promise.resolve(this.username)}else if(this._user){return Promise.resolve(this._user.username)}else{return this.getUser().then((function(e){return e.username}))}};e.prototype.getToken=function(e,t){if(W(this.portal,e)){return this.getFreshToken(t)}else if(new RegExp(this.portal,"i").test(e)){return this.getFreshToken(t)}else{return this.getTokenForServer(e,t)}};e.prototype.validateAppAccess=function(e){return this.getToken(this.portal).then((function(t){return F(t,e)}))};e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}};e.prototype.serialize=function(){return JSON.stringify(this)};e.prototype.enablePostMessageAuth=function(e,t){if(!t&&window){t=window}this._hostHandler=this.createPostMessageHandler(e);t.addEventListener("message",this._hostHandler,false)};e.prototype.disablePostMessageAuth=function(e){if(!e&&window){e=window}e.removeEventListener("message",this._hostHandler,false)};e.prototype.refreshSession=function(e){this._user=null;if(this.username&&this.password){return this.refreshWithUsernameAndPassword(e)}if(this.clientId&&this.refreshToken){return this.refreshWithRefreshToken()}return Promise.reject(new A("Unable to refresh token."))};e.prototype.getServerRootUrl=function(e){var t=N(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0];var n=t.match(/(https?:\/\/)(.+)/),r=n[1],i=n[2];var s=i.split("/"),o=s[0],a=s.slice(1);return""+r+o.toLowerCase()+"/"+a.join("/")};e.prototype.getDomainCredentials=function(e){if(!this.trustedDomains||!this.trustedDomains.length){return"same-origin"}return this.trustedDomains.some((function(t){return e.startsWith(t)}))?"include":"same-origin"};e.prototype.createPostMessageHandler=function(e){var t=this;return function(n){var r=e.indexOf(n.origin)>-1;var i=n.data.type==="arcgis:auth:requestCredential";var s=t.tokenExpires.getTime()>Date.now();if(r&&i){var o={};if(s){var a=t.toCredential();a.server=a.server.replace("/sharing/rest","");o={type:"arcgis:auth:credential",credential:a}}else{o={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Session token was expired, and not returned to the child application"}}}n.source.postMessage(o,n.origin)}}};e.prototype.getTokenForServer=function(e,t){var n=this;var r=this.getServerRootUrl(e);var i=this.federatedServers[r];if(i&&i.expires&&i.expires.getTime()>Date.now()){return Promise.resolve(i.token)}if(this._pendingTokenRequests[r]){return this._pendingTokenRequests[r]}this._pendingTokenRequests[r]=this.fetchAuthorizedDomains().then((function(){return j(r+"/rest/info",{credentials:n.getDomainCredentials(e)}).then((function(i){if(i.owningSystemUrl){if(!G(i.owningSystemUrl,n.portal)){throw new A(e+" is not federated with "+n.portal+".","NOT_FEDERATED")}else{return j(i.owningSystemUrl+"/sharing/rest/info",t)}}else if(i.authInfo&&n.federatedServers[r]!==undefined){return Promise.resolve({authInfo:i.authInfo})}else{throw new A(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")}})).then((function(e){return e.authInfo.tokenServicesUrl})).then((function(t){if(n.token&&n.tokenExpires.getTime()>Date.now()){return I(t,{params:{token:n.token,serverUrl:e,expiration:n.tokenDuration,client:"referer"}})}else{return I(t,{params:{username:n.username,password:n.password,expiration:n.tokenDuration,client:"referer"}}).then((function(e){n._token=e.token;n._tokenExpires=new Date(e.expires);return e}))}})).then((function(e){n.federatedServers[r]={expires:new Date(e.expires),token:e.token};delete n._pendingTokenRequests[r];return e.token}))}));return this._pendingTokenRequests[r]};e.prototype.getFreshToken=function(e){var t=this;if(this.token&&!this.tokenExpires){return Promise.resolve(this.token)}if(this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()){return Promise.resolve(this.token)}if(!this._pendingTokenRequests[this.portal]){this._pendingTokenRequests[this.portal]=this.refreshSession(e).then((function(e){t._pendingTokenRequests[t.portal]=null;return e.token}))}return this._pendingTokenRequests[this.portal]};e.prototype.refreshWithUsernameAndPassword=function(e){var t=this;var n=g({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e);return I(this.portal+"/generateToken",n).then((function(e){t._token=e.token;t._tokenExpires=new Date(e.expires);return t}))};e.prototype.refreshWithRefreshToken=function(e){var t=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now()){return this.refreshRefreshToken(e)}var n=g({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return q(this.portal+"/oauth2/token",n).then((function(e){t._token=e.token;t._tokenExpires=e.expires;return t}))};e.prototype.refreshRefreshToken=function(e){var t=this;var n=g({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return q(this.portal+"/oauth2/token",n).then((function(e){t._token=e.token;t._tokenExpires=e.expires;t._refreshToken=e.refreshToken;t._refreshTokenExpires=new Date(Date.now()+(t.refreshTokenTTL-1)*60*1e3);return t}))};e.prototype.fetchAuthorizedDomains=function(){var e=this;if(this.server||!this.portal){return Promise.resolve(this)}return this.getPortal().then((function(t){if(t.authorizedCrossOriginDomains&&t.authorizedCrossOriginDomains.length){e.trustedDomains=t.authorizedCrossOriginDomains.filter((function(e){return!e.startsWith("http://")})).map((function(e){if(e.startsWith("https://")){return e}else{return"https://"+e}}))}return e}))};return e}();function J(e){if(e===void 0){e={}}if(e.portal){return N(e.portal)}if(e.authentication){return e.authentication.portal}return"https://www.arcgis.com/sharing/rest"}var K=/[\x00-\x1F\x7F-\x9F\xA0]/g;function V(e){return e.replace(K,"")}function B(e,t){var n=Y(e,t);var r=g({httpMethod:"GET"},t);return j(n,r)}var Y=function(e,t){var n=typeof t==="string"?t:J(t);return n+"/content/items/"+e};function Q(e,t){var n=Y(e,t)+"/data";var r=g({httpMethod:"GET",params:{}},t);if(r.file){r.params.f=null}return j(n,r).catch((function(e){var t=RegExp(/The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i);if(t.test(e.message)){return}else throw e}))}function z(e,t){var n=Y(e,t)+"/groups";return j(n,t)}function X(e,t){var n=t||{},r=n.fileName,i=r===void 0?"iteminfo.xml":r,s=n.readAs,o=s===void 0?"text":s;var a=g({httpMethod:"GET"},t);return ee(e,"/info/"+i,o,a)}function Z(e,t){var n=g(g({},t),{fileName:"metadata/metadata.xml"});return X(e,n)}function ee(e,t,n,r){var i=""+Y(e,r)+t;var s=g({params:{}},r);var o=s.rawResponse;s.rawResponse=true;s.params.f=null;return j(i,s).then((function(e){if(o){return e}return n!=="json"?e[n]():e.text().then((function(e){return JSON.parse(V(e))}))}))}function te(e,t){var n=J(t)+"/community/groups/"+e+"/userlist";var r=T(t||{},["name","num","start","sortField","sortOrder","joined","memberType"],{httpMethod:"GET"});return j(n,r)}var ne=function(){function e(e){if(e===void 0){e=""}this.termStack=[];this.rangeStack=[];this.openGroups=0;this.q=e}e.prototype.match=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this.termStack=this.termStack.concat(e);return this};e.prototype.in=function(e){var t="`in("+(e?'"'+e+'"':"")+")`";if(!this.hasRange&&!this.hasTerms){D(t+" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified.");return this}if(e&&e!=="*"){this.q+=e+":"}return this.commit()};e.prototype.startGroup=function(){this.commit();if(this.openGroups>0){this.q+=" "}this.openGroups++;this.q+="(";return this};e.prototype.endGroup=function(){if(this.openGroups<=0){D("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified.");return this}this.commit();this.openGroups--;this.q+=")";return this};e.prototype.and=function(){return this.addModifier("and")};e.prototype.or=function(){return this.addModifier("or")};e.prototype.not=function(){return this.addModifier("not")};e.prototype.from=function(e){if(this.hasTerms){D('`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.');return this}this.rangeStack[0]=e;return this};e.prototype.to=function(e){if(this.hasTerms){D('`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.');return this}this.rangeStack[1]=e;return this};e.prototype.boost=function(e){this.commit();this.q+="^"+e;return this};e.prototype.toParam=function(){this.commit();this.cleanup();return this.q};e.prototype.clone=function(){this.commit();this.cleanup();return new e(this.q+"")};e.prototype.addModifier=function(e){if(this.currentModifer){D("You have called `"+this.currentModifer+"()` after `"+e+"()`. Your current query was not modified.");return this}this.commit();if(this.q===""&&e!=="not"){D("You have called `"+e+"()` without calling another method to modify your query first. Try calling `match()` first.");return this}this.currentModifer=e;this.q+=this.q===""?"":" ";this.q+=e.toUpperCase()+" ";return this};e.prototype.needsQuotes=function(e){return/\s|:/g.test(e)};e.prototype.formatTerm=function(e){if(e instanceof Date){return e.getTime()}if(typeof e==="string"&&this.needsQuotes(e)){return'"'+e+'"'}return e};e.prototype.commit=function(){var e=this;this.currentModifer=undefined;if(this.hasRange){this.q+="["+this.formatTerm(this.rangeStack[0])+" TO "+this.formatTerm(this.rangeStack[1])+"]";this.rangeStack=[undefined,undefined]}if(this.hasTerms){this.q+=this.termStack.map((function(t){return e.formatTerm(t)})).join(" ");this.termStack=[]}return this};Object.defineProperty(e.prototype,"hasTerms",{get:function(){return this.termStack.length>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"hasRange",{get:function(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]},enumerable:false,configurable:true});e.prototype.cleanup=function(){if(this.openGroups>0){D("Automatically closing "+this.openGroups+" group(s). You can use `endGroup(...)` to remove this warning.");while(this.openGroups>0){this.q+=")";this.openGroups--}}var e=this.q;this.q=e.replace(/( AND ?| NOT ?| OR ?)*$/,"");if(e!==this.q){D("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified.")}this.q=this.q.replace(/(\(\))*/,"")};return e}();function re(e,t){var n;if(typeof e==="string"||e instanceof ne){n={httpMethod:"GET",params:{q:e}}}else{n=T(e,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"})}var r;switch(t){case"item":r="/search";break;case"group":r="/community/groups";break;case"groupContent":if(typeof e!=="string"&&!(e instanceof ne)&&e.groupId){r="/content/groups/"+e.groupId+"/search"}else{return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"))}break;default:r="/portals/self/users/search";break}var i=J(n)+r;return j(i,n).then((function(n){if(n.nextStart&&n.nextStart!==-1){n.nextPage=function(){var r;if(typeof e==="string"||e instanceof ne){r={q:e,start:n.nextStart}}else{r=e;r.start=n.nextStart}return re(r,t)}}return n}))}function ie(e){return re(e,"item")}function se(e){return re(e,"group")}function oe(e){return re(e,"groupContent")}function ae(e){var t;var n={httpMethod:"GET"};if(typeof e==="string"){t="https://www.arcgis.com/sharing/rest/community/users/"+e}else{var r=e.username||e.authentication.username;t=J(e)+"/community/users/"+encodeURIComponent(r);n=g(g({},e),n)}return j(t,n)}function ce(e){return re(e,"user")}function ue(e,t){var n=e?e:"self";var r=J(t)+"/portals/"+n;var i=g({httpMethod:"GET"},t);return j(r,i)}function fe(e){if(typeof e==="string"){return e.replace(/\/sharing\/rest\/?$/,"")}if(typeof e==="object"){const t=e.portalSelf;const n=t||e;const{portalHostname:r,urlKey:i,customBaseUrl:s}=n;if(r||i&&s){if(n.isPortal){return`https://${n.portalHostname}`}else{return`https://${n.urlKey}.${n.customBaseUrl}`}}}return fe(J(e))}function le(e){return`${fe(e)}/sharing/rest`}function pe(e,t){const n=fe(t);return`${n}/home/item.html?id=${e}`}const he=(e,t,n)=>{const{id:r,access:i}=e;const s=`${le(t)}/content/items/${r}`;const o=new URLSearchParams({f:"json"});if(i!=="public"&&n){o.append("token",n)}return`${s}?${o.toString()}`};function de(e){let t=e;if(e.match(/(qaext|\.mapsqa)\.arcgis.com/)){t="https://qaext.arcgis.com"}else if(e.match(/(devext|\.mapsdevext)\.arcgis.com/)){t="https://devext.arcgis.com"}else{if(e.match(/(www|\.maps)\.arcgis.com/)){t="https://www.arcgis.com"}}return t}function me(e,t){const n=fe(t);return`${n}/home/group.html?id=${e}`}function ge(e,t){const n=fe(t);return`${n}/home/user.html?user=${e}`}const be=["Application","City Engine Web Scene","CityEngine Web Scene","Dashboard","Insights Page","Insights Workbook","Operation View","Web Mapping Application","StoryMap","Web Experience","Urban Model"];const we=["CSV Collection","CSV","Feature Collection Template","Feature Collection","Feature Layer","Feature Service","File Geodatabase","GeoJSON","GeoJson","KML Collection","KML","Microsoft Excel","Raster Layer","Shapefile","Stream Service","Table"];const ye=["CAD Drawing","Document Link","Hub Page","Site Page","Image","iWork Keynote","iWork Numbers","iWork Pages","Microsoft Powerpoint","Microsoft Visio","Microsoft Word","Notebook","PDF","Pro Map","Report Template"];const ve=["Hub Event"];const Oe=["Form","Quick Capture Project"];const ke=["Hub Initiative"];const Se=["Solution"];const De=["Hub Initiative Template"];const $e=["Image Collection","Image Service","Map Service Layer","Map Service","Scene Service","Scene Layer","Vector Tile Service","Web Map Service","Web Map Tile Service","Web Map","Web Scene","WFS","WMS","WMTS"];const Ee=["360 VR Experience","AppBuilder Widget Package","Application Configuration","ArcPad Package","Code Attachment","Code Sample","Desktop Add In","Desktop Application Template","Desktop Application","Desktop Style","Explorer Add In","Explorer Layer","Geocoding Service","Geometry Service","Geoprocessing Package","Geoprocessing Sample","Geoprocessing Service","Layer File","Layer Package","Layer Template","Layer","Layout","Locator Package","Map Area","Map Document","Map Package","Map Service Definition","Map Template","Mobile Application","Mobile Map Package","Native Application","Network Analysis Service","Operations Dashboard Add In","Project Package","Project Template","Raster Function Template","Rule Package","Scene Package","Service Definition","SQLite Geodatabase","Style","Tile Package","Vector Tile Package","Workflow Manager Package"];const Ae=["Hub Site Application","Site Application"];const xe=e=>{if(!e){return}const t=e.toLocaleLowerCase();return Object.keys(Te).find((e=>{const n=Te[e];return n.some((e=>e.toLocaleLowerCase()===t))}))};const je=e=>{if(!e){return}const t=e.toLocaleLowerCase();return Te[t]};const Te={app:be,dataset:we,document:ye,event:ve,feedback:Oe,initiative:ke,template:De,solution:Se,map:$e,other:Ee,site:Ae};var Ne=new RegExp(/.+(?:map|feature|image)server/i);function Re(e){var t=e.match(Ne);if(t){return t[0]}else{return Pe(e)}}function Pe(e){var t=e.split("?")[0];return N(t)}function qe(e){var t=e.url,n=b(e,["url"]);var r=Re(t)+"/layers";return j(r,n)}function Ie(e){return j(N(e.url),e)}function Me(e,t,n){if(!e||!e.thumbnail){return null}let{token:r,width:i}=n||{};if(!r&&typeof n==="string"){r=n}const s=he(e,t,r);const[o,a]=s.split("?");const c=new URLSearchParams(a);c.delete("f");if(i){c.append("w",i+"")}const u=c.toString();const f=`${o}/info/${e.thumbnail}`;return u?`${f}?${u}`:f}class _e extends l{constructor(e,t,n){t=t||"UNKNOWN_ERROR";n=u(n,"rootCause",n);super(e,t,n);this.name="HubError";this.stack=u(n,"stack",(new Error).stack)}}function Ce(e){if(e.indexOf("|")>-1){e=e.replace("|","::")}return e}const Ue=async(e,t)=>{let n;try{const r=typeof e==="string"?await B(e,t):e;if(r.url){let e=Re(r.url);if(r.access!=="public"&&t.authentication){const n=await t.authentication.getToken(r.url,t);if(n){e=`${e}?token=${n}`}}const{status:i}=await fetch(e);n=i!==200}else{n=true}}catch(e){n=true}return n};function Ge(e){var t;const n=(t=e.properties)===null||t===void 0?void 0:t.slug;return n?Ce(n):e.id}function We(e){const t={other:"content",solution:"template"};return t[e]||e}function Fe(e){let t;switch(e.toLowerCase()){case"image service":t="dataset";break;case"feature service":case"raster layer":t="map";break;case"microsoft excel":t="document";break;case"cad drawing":case"feature collection template":case"report template":t="content";break;case"hub project":t="project";break;default:t=We(xe(e))}return t}function Le(e){let t;switch(e.toLowerCase()){case"content":t=je("other");t=t.concat(["CAD Drawing","Feature Collection Template","Report Template"]);break;case"template":t=[...je("template"),...je("solution")];break;case"dataset":t=je(e.toLowerCase()).filter((e=>e!=="Feature Collection Template"&&e!=="Raster Layer"&&e!=="Microsoft Excel"));t=t.concat("Image Service");break;case"map":t=je(e.toLowerCase()).filter((e=>e!=="Image Service"));t=t.concat(["Raster Layer"]);break;case"document":t=je(e.toLowerCase()).filter((e=>e!=="CAD Drawing"&&e!=="Report Template"));t=t.concat("Microsoft Excel");break;case"project":t=["Hub Project"];break;default:t=je(e.toLowerCase())}return t}class He{constructor(){this.operations=[]}startOperation(e){const t=s(e);t.startedAt=(new Date).getTime();t.state="working";this.operations.push(t)}start(e,t){const n={type:e,id:u(t,"id",o(`${e}_`)),inputs:u(t,"inputs",{}),cleanup:u(t,"cleanup","n/a"),startedAt:(new Date).getTime(),state:"working"};this.operations.push(n);return n.id}getOperation(e){return this.operations.find((t=>t.id===e))}getOperations(){return this.operations}finish(e,t){const n=this.getOperation(e);if(n){n.duration=(new Date).getTime()-n.startedAt;n.state="completed";if(t){n.output=s(t)}}else{throw new Error(`No operation with id ${e} present in stack`)}}merge(e){this.operations=[...this.operations,...e.operations]}getCompleted(){return s(this.operations.filter((e=>e.state==="completed")))}getWorking(){return s(this.operations.filter((e=>e.state==="working")))}toString(){const e=this.operations.sort(((e,t)=>{if(e.startedAt<t.startedAt){return-1}if(t.startedAt<e.startedAt){return 1}return 0}));return e.map(Je).join("\n")}serialize(){return{operations:s(this.getOperations())}}}function Je(e){let t=`${e.startedAt} : Operation ${e.id} started with inputs ${JSON.stringify(e.inputs)} but was not completed`;if(e.state==="completed"){t=`${e.startedAt} : Operation ${e.id} took ${e.duration} ms with inputs ${JSON.stringify(e.inputs)} and output ${e.output?JSON.stringify(e.output):"n/a"}`}return t}function Ke(e,t){const r=n(t,"portal")||n(t,"authentication.portal")||"www.arcgis.com";const i=`${de(r)}/sharing/rest`;return ue(e,Object.assign(Object.assign({},t),{portal:i}))}async function Ve(e){const{parse:t}=await import("./p-5687ec85.js").then((function(e){return e.p}));const n={ignoreAttributes:false,attributeNamePrefix:"@_",textNodeName:"#value"};return t(e,n)}async function Be(e,t){try{const n=await Z(e,t);return await Ve(n)}catch(e){return null}}const Ye=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichGroupIds");return z(t.item.id,r).then((e=>{const{admin:s,member:o,other:a}=e;const c=[...s,...o,...a].map((e=>e.id));n.finish(i);return{data:Object.assign(Object.assign({},t),{groupIds:c}),stack:n,requestOptions:r}})).catch((t=>nt(t,e,i)))};const Qe=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichMetadata");return Be(t.item.id,r).then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{metadata:e}),stack:n,requestOptions:r}}))};const ze=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichOwner");const s=Object.assign({username:t.item.owner},r);return ae(s).then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{ownerUser:e}),stack:n,requestOptions:r}})).catch((t=>nt(t,e,i)))};const Xe=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichOrg");const s=mt(t.item,t.ownerUser);const o=s?Ke(s,r):Promise.resolve(undefined);return o.then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{org:e}),stack:n,requestOptions:r}})).catch((t=>nt(t,e,i)))};const Ze=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichData");return Q(t.item.id,r).then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{data:e}),stack:n,requestOptions:r}})).catch((t=>nt(t,e,i)))};const et=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichServer");const s=Re(t.item.url);const o=Object.assign(Object.assign({},r),{url:s});return Promise.all([Ie(o),Ue(t.item,r)]).then((([e,s])=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{server:Object.assign(Object.assign({},e),{servicesDirectoryDisabled:s})}),stack:n,requestOptions:r}})).catch((t=>nt(t,e,i)))};const tt=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichLayers");const s=t.item.url;const o=Object.assign(Object.assign({},r),{url:s});return qe(o).then((e=>{const t=[...e.layers,...e.tables];return t.filter((e=>e.type!=="Group Layer"))})).then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{layers:e}),stack:n,requestOptions:r}})).catch((t=>nt(t,e,i)))};const nt=(e,t,n)=>{const{data:r,stack:i,requestOptions:s}=t;i.finish(n,{error:e});return{data:Object.assign(Object.assign({},r),{errors:it(e,r.errors)}),stack:i,requestOptions:s}};const rt={groupIds:Ye,metadata:Qe,ownerUser:ze,org:Xe,data:Ze,server:et,layers:tt};const it=(e,t=[])=>{const n=typeof e==="string"?e:e.message;return[...t,{type:"Other",message:n}]};const st=(e,t,n)=>{const r=t.reduce(((e,t)=>{const n=rt[t];n&&e.push(n);return e}),[]);const i=p(r);return i({data:{item:e},stack:new He,requestOptions:n}).then((e=>e.data))};class ot extends Error{constructor(e,t,n){super(e);this.status=n;this.url=t}}function at(e){const t=e.split(" AS ");const n=t[0];const r=t[1]||n.split(".").reverse()[0];const i=n.split(".")[0];const s={enrichment:i,path:n,prop:r};return s}async function ct(e,t,r){const i={access:e.access,id:e.id,type:e.type,name:e.title,owner:e.owner,typeKeywords:e.typeKeywords,tags:e.tags,categories:e.categories,summary:e.snippet||e.description,createdDate:new Date(e.created),createdDateSource:"item.created",updatedDate:new Date(e.modified),updatedDateSource:"item.modified",family:Fe(e.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}};const s=[];t=[...s,...t].filter(a);const o=t.map(at);const c=h("enrichment",o).filter(a);let u={};if(c.length){u=await st(e,c,r)}o.forEach((e=>{i[e.prop]=n(u,e.path)}));i.links.thumbnail=Me(e,r);i.links.self=pe(i.id,r);const f=Ge(e);i.links.siteRelative=ft(i.type,f,e.typeKeywords);return i}async function ut(e,t,r){const i={access:e.access,id:e.id,type:e.type,name:e.title,owner:e.owner,typeKeywords:e.typeKeywords,tags:e.tags,categories:e.categories,summary:e.snippet||e.description,createdDate:new Date(e.created),createdDateSource:"item.created",updatedDate:new Date(e.modified),updatedDateSource:"item.modified",family:Fe(e.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}};const s=[];t=[...s,...t].filter(a);const o=t.map(at);const c=h("enrichment",o).filter(a);let u={};if(c.length){u=await st(e,c,r)}o.forEach((e=>{i[e.prop]=n(u,e.path)}));i.links.thumbnail=Me(e,r);i.links.self=e.url;i.links.siteRelative=ft(i.type,i.id,e.typeKeywords);return i}const ft=(e,t,n)=>{let r=pt(e,t,n)||ht(e,t,n);if(!r){const i=Fe(e);const s=["app","dataset","document","map","template","project"];let o="/content";if(i==="feedback"){o="/feedback/surveys"}else if(lt(e,n)){o="/pages"}else if(s.indexOf(i)>-1){o=`/${i}s`}r=`${o}/${t}`}return r};const lt=(e,t=[])=>["Hub Page","Site Page"].includes(e)||t.includes("hubPage");const pt=(e,t,n)=>{let r;if(e==="Solution"){if((n===null||n===void 0?void 0:n.indexOf("Deployed"))>-1){r=`/content/${t}/about`}else{r=`/templates/${t}/about`}}else if(e==="Web Mapping Application"&&(n===null||n===void 0?void 0:n.indexOf("hubSolutionTemplate"))>-1){r=`/templates/${t}/about`}return r};const ht=(e,t,n)=>{if(e==="Hub Initiative"&&(n===null||n===void 0?void 0:n.indexOf("hubInitiativeTemplate"))>-1||e==="Hub Initiative Template"){return`/initiatives/templates/${t}/about`}};var dt;(function(e){e["Year"]="year";e["Month"]="month";e["Day"]="day";e["Time"]="time"})(dt||(dt={}));const mt=(e,t)=>e.orgId||(t===null||t===void 0?void 0:t.orgId);async function gt(e,t,r){const i={access:e.access,id:e.id,type:e.type,name:e.title,owner:e.owner,tags:e.tags,typeKeywords:e.typeKeywords,categories:e.categories,summary:e.snippet||e.description,createdDate:new Date(e.created),createdDateSource:"item.created",updatedDate:new Date(e.modified),updatedDateSource:"item.modified",family:Fe(e.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}};const s=[];t=[...s,...t].filter(a);const o=t.map(at);const c=h("enrichment",o).filter(a);let u={};if(c.length){u=await st(e,c,r)}o.forEach((e=>{i[e.prop]=n(u,e.path)}));i.links.thumbnail=Me(e,r);i.links.self=pe(i.id,r);i.links.siteRelative=ft(i.type,i.id,e.typeKeywords);return i}const bt=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichGroupContentCount");const s=Object.assign({groupId:t.group.id,num:1},r);return oe(s).then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{contentCount:e.total}),stack:n,requestOptions:r}})).catch((t=>yt(t,e,i)))};const wt=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichGroupContentCount");const s=Object.assign({num:3},r);return te(t.group.id,s).then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{membershipSummary:{total:e.total,users:e.users}}),stack:n,requestOptions:r}})).catch((t=>yt(t,e,i)))};const yt=(e,t,n)=>{const{data:r,stack:i,requestOptions:s}=t;i.finish(n,{error:e});return{data:Object.assign(Object.assign({},r),{errors:it(e,r.errors)}),stack:i,requestOptions:s}};const vt={membershipSummary:wt,contentCount:bt};function Ot(e,t,n){const r=t.reduce(((e,t)=>{const n=vt[t];n&&e.push(n);return e}),[]);const i=p(r);return i({data:{group:e},stack:new He,requestOptions:n}).then((e=>e.data))}const kt={arcgis:{label:"ArcGIS Online",url:"https://www.arcgis.com",type:"arcgis"},arcgisQA:{label:"ArcGIS Online QAEXT",url:"https://qaext.arcgis.com",type:"arcgis"},arcgisDEV:{label:"ArcGIS Online DEVEXT",url:"https://devext.arcgis.com",type:"arcgis"},hub:{label:"ArcGIS Hub",url:"https://hub.arcgis.com/api",type:"arcgis-hub"},hubDEV:{label:"ArcGIS Hub DEV",url:"https://hubdev.arcgis.com/api",type:"arcgis-hub"},hubQA:{label:"ArcGIS Hub QA",url:"https://hubqa.arcgis.com/api",type:"arcgis-hub"}};function St(e){if(typeof e==="string"&&e in kt){return kt[e]}else{return e}}function Dt(e){let t={};if(Array.isArray(e)){t={any:e}}else{if(typeof e==="string"){t={any:[e]}}if(typeof e==="object"){t=e}}return t}function $t(e){const t={min:1e3*60,hours:1e3*60*60,days:1e3*60*60*24,weeks:1e3*60*60*24*7};const n=new Date;const r={type:"date-range",from:n.getTime(),to:n.getTime()};switch(e.unit){case"hours":case"days":case"weeks":r.from=r.to-t[e.unit]*e.num;break;case"months":n.setMonth(n.getMonth()-e.num);r.from=n.getTime();break;case"years":n.setFullYear(n.getFullYear()-e.num);r.from=n.getTime();break}return r}function Et(e,t,n,r){const i=s(e);if(e.authentication){i.authentication=H.deserialize(e.authentication.serialize())}i.start=t>-1?t:n+1;return e=>{if(e){i.authentication=e}return r(i)}}function At(e,t,n){let r=null;if(t.thumbnail){r=`${e}/community/groups/${t.id}/info/${t.thumbnail}`;if(n&&t.access!=="public"){r=`${r}?token=${n}`}}return r}function xt(e,t,n){let r=null;if(t.thumbnail){r=`${e}/community/users/${t.username}/info/${t.thumbnail}`;if(n&&t.access!=="public"){r=`${r}?token=${n}`}}return r}function jt(e,t){let n=null;const r=t.filter((t=>t.predicates.find((t=>!!t[e]))));if(r.length>1){throw new Error(`Only 1 IFilter can have a '${e}' predicate but ${r.length} were detected`)}if(r.length){const t=r[0];const i=t.predicates.filter((t=>!!t[e]));if(i.length>1){throw new Error(`Only 1 '${e}' predicate is allowed but ${i.length} were detected`)}if(t.operation!=="AND"&&t.predicates.length>1){throw new Error(`'${e}' predicates cannot be OR'd to other predicates`)}const s=i[0];if(typeof s[e]!=="string"){throw new Error(`'${e}' predicate must have a string value, string[] and IMatchOptions are not allowed.`)}n=s}return n}function Tt(e){const t={};const r=["created","modified","lastlogin"];const i=["filterType","categoriesAsParam","categoryFilter","term","searchUserAccess","isopendata","searchUserName","bbox","isviewonly"];const o=[...r,...i];Object.entries(e).forEach((([a,c])=>{if(!o.includes(a)){f(a,Dt(c),t)}if(r.includes(a)){const r=s(n(e,a));if(n(e,`${a}.type`)==="relative-date"){f(a,$t(r),t)}else{f(a,r,t)}}if(i.includes(a)&&e.hasOwnProperty(a)){f(a,c,t)}}));return t}function Nt(e){const t=e.filters.map(qt);const n=t.filter(Rt);const r=Pt(n,"AND");const i=jt("bbox",e.filters);if(i){r.params={bbox:i.bbox}}return r}function Rt(e){return!(typeof e==="undefined"||e===null||e==="")}function Pt(e,t){const n=e.reduce(((e,n)=>{Object.entries(n).forEach((([n,r])=>{if(e[n]&&r!==""){e[n]=`${e[n]} ${t} ${r}`}else{if(r!==""){e[n]=r}}}));return e}),{q:""});return n}function qt(e){const t=e.operation||"AND";const n=e.predicates.map(Tt);const r=n.map(It).filter((e=>e!==undefined&&e!==null));const i=Pt(r,t);if(n.length>1){i.q=`(${i.q})`}return i}function It(e){const t=["created","modified"];const n=["isopendata","isviewonly"];const r=["searchUserAccess","searchUserName","categoriesAsParam","categoryFilter","bbox"];const i=["filterType","term",...t,...n,...r];const s=["access","capabilities","created","categories","categoriesAsParam","categoryFilter","description","disabled","email","emailstatus","firstname","fullname","group","id","isInvitationOnly","isopendata","joined","lastlogin","lastname","memberType","modified","name","orgid","orgIds","owner","provider","role","searchUserAccess","searchUserName","snippet","tags","term","title","type","typekeywords","userlicensetype","username","isviewonly"];const o=Object.entries(e).map((([e,o])=>{if(s.includes(e)){const s={q:""};if(!i.includes(e)&&e!=="term"){s.q=Mt(e,o)}if(t.includes(e)){s.q=_t(e,o)}if(n.includes(e)){s.q=`${e}:${o}`}if(r.includes(e)){s[e]=o}if(e==="term"){s.q=o}return s}})).filter(Rt);if(o.length){const e=Pt(o,"AND");if(e.q){e.q=`(${e.q})`}return e}else{return null}}function Mt(e,t){let n="";if(t.any){n=`${Ct("OR",e,t.any)}`}if(t.all){n=(n?n+" AND ":"")+`${Ct("AND",e,t.all)}`}if(t.not){n=(n?n+" AND ":"")+`${Ct("OR",`-${e}`,t.not)}`}return n}function _t(e,t){return`${e}:[${t.from} TO ${t.to}]`}function Ct(e,t,n){let r="";if(Array.isArray(n)){r=`${t}:"${n.join(`" ${e} ${t}:"`)}"`;if(n.length>1){r=`(${r})`}}else{r=`${t}:"${n}"`}return r}function Ut(e,t){const{site:n,requestOptions:{isPortal:r}}=t;return e==="item"&&!!n&&!r}function Gt(e){const t=new URL(e.requestOptions.hubApiUrl).hostname;return{type:"arcgis-hub",url:`https://${t}/api/search/v1`}}function Wt(e,t){const{api:n,requestOptions:{portal:r}}=t;let i;if(n){i=St(n)}else if(Ut(e,t)){i=Gt(t)}else{i={type:"arcgis",url:r}}return i}async function Ft(e,t,r){const i={access:e.access,id:e.id,type:e.type,name:e.title,owner:e.owner,typeKeywords:e.typeKeywords,tags:e.tags,categories:e.categories,summary:e.snippet||e.description,createdDate:new Date(e.created),createdDateSource:"item.created",updatedDate:new Date(e.modified),updatedDateSource:"item.modified",family:Fe(e.type),links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}};const s=[];t=[...s,...t].filter(a);const o=t.map(at);const c=h("enrichment",o).filter(a);let u={};if(c.length){u=await st(e,c,r)}o.forEach((e=>{i[e.prop]=n(u,e.path)}));i.links.thumbnail=Me(e,r);i.links.self=pe(i.id,r);i.links.siteRelative=ft(i.type,i.id,e.typeKeywords);return i}function Lt(e){var t;if((t=e.aggregations)===null||t===void 0?void 0:t.counts){return e.aggregations.counts.map((e=>({mode:"terms",field:e.fieldName,values:e.fieldValues})))}else{return[]}}function Ht(e){return e&&e.slice(-1)!=="."?`${e}.`:e}function Jt(e,t){return{appAndMap:{key:"appAndMap",label:`{{${e}collection.appsAndMaps:translate}}`,targetEntity:t,include:[],scope:{targetEntity:t,filters:[{predicates:[{type:[...Le("app"),...Le("map")]}]}]}},dataset:{key:"dataset",label:`{{${e}collection.dataset:translate}}`,targetEntity:t,include:[],scope:{targetEntity:t,filters:[{predicates:[{type:Le("dataset")}]}]}},document:{key:"document",label:`{{${e}collection.documents:translate}}`,targetEntity:t,include:[],scope:{targetEntity:t,filters:[{predicates:[{type:Le("document")}]}]}},feedback:{key:"feedback",label:`{{${e}collection.feedback:translate}}`,targetEntity:t,include:[],scope:{targetEntity:t,filters:[{predicates:[{type:Le("feedback")}]}]}},site:{key:"site",label:`{{${e}collection.sites:translate}}`,targetEntity:t,include:[],scope:{targetEntity:t,filters:[{predicates:[{type:Le("site")}]}]}},template:{key:"template",label:`{{${e}collection.templates:translate}}`,targetEntity:t,include:[],scope:{targetEntity:t,filters:[{predicates:[{type:Le("template")}]}]}}}}function Kt(e,t,n){e=Ht(e);return Jt(e,t)[n]}async function Vt(e,t){const n=Bt(t,e);return Yt(n)}function Bt(e,t){var n;if(!e.requestOptions){throw new _e("portalSearchItems","options.requestOptions is required.")}let r=Xt(t);r=Zt(r);r.filters=r.filters.map((e=>{e.predicates=e.predicates.map(Tt);return e}));const i=Nt(r);const s=["num","sortField","sortOrder","include","start","requestOptions"];s.forEach((t=>{if(e.hasOwnProperty(t)){i[t]=e[t]}}));if(e.requestOptions.authentication){i.authentication=e.requestOptions.authentication}else{i.portal=e.requestOptions.portal}if((n=e.aggFields)===null||n===void 0?void 0:n.length){i.countFields=e.aggFields.join(",");i.countSize=e.aggLimit||10}return i}async function Yt(e){const t=await ie(e);const n=t=>Qt(t,e.includes,e.requestOptions);const r=await Promise.all(t.results.map(n));const i=Lt(t);return{total:t.total,results:r,aggregations:i,hasNext:t.nextStart>-1,next:Et(e,t.nextStart,t.total,Yt)}}async function Qt(e,t=[],n){let r=gt;switch(e.type){case"Hub Site Application":case"Site Application":r=ut;break;case"Hub Page":case"Site Page":r=Ft;break;case"Hub Project":r=ct;break;case"Web Mapping Application":if(e.typeKeywords.includes("hubSite")){r=ut}break}return r(e,t,n)}const zt={$application:[{type:{any:["Web Mapping Application","Application","Insights","Web Experience"],not:["Insights Theme","Insights Model"]},typekeywords:{not:["hubSite","Story Map"]}},{type:"Web Mapping Experience",typekeywords:"EXB Experience"}],$dashboard:[{type:{any:["Dashboard"],not:["Operation View"]},typekeywords:{not:["Extension","ArcGIS Operation View"]}}],$dataset:[{type:{any:["Scene Service","Feature Collection","Route Layer","Layer","Explorer Layer","Tile Package","Vector Tile Package","Scene Package","Layer Package","Feature Service","Stream Service","Map Service","Vector Tile Service","Image Service","WMS","WFS","WMTS","KML","KML Collection","Globe Service","CSV","Shapefile","GeoJson","Service Definition","File Geodatabase","CAD Drawing","Relational Database Connection"],not:["Web Mapping Application","Geodata Service"]}},{typekeywords:["OGC","Geodata Service"]}],$document:[{type:["PDF","Microsoft Excel","Microsoft Word","Microsoft Powerpoint","iWork Keynote","iWork Pages","iWork Numbers","Visio Document","Document Link"]}],$initiative:[{type:"Hub Initiative"}],$experience:[{type:"Web Experience"}],$feedback:[{type:"Form"}],$page:[{typekeywords:"hubPage"}],$site:[{type:["Hub Site Application","Site Application"]}],$storymap:[{type:"Storymap"},{type:"Web Mapping Application",typekeywords:"Story Map"}],$template:[{type:["Web Mapping Application","Hub Initiative","Hub Initiative Template","Solution"],typekeywords:{any:["hubInitiativeTemplate","hubSolutionTemplate","Template"],not:"Deployed"}}],$webmap:[{type:{any:["Web Map","Web Scene"],not:"Web Mapping Application"}}]};function Xt(e){const t=s(e);if(t.collection){const{collection:r,targetEntity:i,filters:s}=e;const o=Kt("",i,r);const a=n(o,"scope.filters")||[];t.filters=[...s,...a]}return t}function Zt(e){const t=s(e);t.filters=t.filters.map((e=>{let t=false;e.predicates=e.predicates.reduce(((e,n)=>{if(en(n.type)){const r=tn(n.type);e=[...e,...r];t=true}else{e.push(n)}return e}),[]);if(t){e.operation="OR"}return e}));return t}function en(e){let t=false;if(typeof e==="string"){t=e in zt}return t}function tn(e){return zt[e]}function nn(e){const t=e.aggregations.aggregations.map((e=>({mode:"terms",field:e.field,values:e.aggregations.map((e=>({value:e.label,count:e.value})))})));return{total:0,results:[],hasNext:false,next:()=>null,aggregations:t}}function rn(e,t){const r=`terms(fields=(${t.aggFields.join()}))`;const i=n(t,"requestOptions.authentication.token");return{aggregations:r,token:i}}function sn(e,t){const n=t.api;const r=e.collection||"all";return`${n.url}/collections/${r}`}function on(e){const t=Object.entries(e).filter((([e,t])=>!!t)).map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&");return t&&`?${t}`}async function an(e,t,n){var r;const i=s(t);const o=new URL(n.site).hostname;const a=new URL(e).hostname;if(o!==a){i.target=o}const c=e+on(i);const u=((r=n.requestOptions)===null||r===void 0?void 0:r.fetch)||fetch;const f=await u(c,{method:"GET"});if(!f.ok){throw new ot(f.statusText,c,f.status)}return f.json()}async function cn(e,t){const n=`${sn(e,t)}/aggregations`;const r=rn(e,t);const i=await an(n,r,t);return nn(i)}function un(e,t,n){const r=e.links.find((e=>e.rel==="next"));let i=()=>null;if(r){i=()=>{const e=new URL(r.href);const i=+e.searchParams.get("startindex");const s=Object.assign(Object.assign({},n),{start:i});return jn(t,s)}}return i}async function fn(e,t,n){const r=e.properties;const i=await Qt(r,t,n);i.source=e.properties.source;i.license=e.properties.license;return i}async function ln(e,t,n){const r=await Promise.all(e.features.map((e=>fn(e,n.include,n.requestOptions))));const i=un(e,t,n);const s=e.links.find((e=>e.rel==="next"));return{total:e.numberMatched,results:r,hasNext:!!s,next:i}}function pn(e){const t=jt("bbox",e.filters);return t===null||t===void 0?void 0:t.bbox}function hn(e){return e.filters.map(dn).filter($n).join(" AND ")}function dn(e){const t=e.operation||"OR";const n=e.predicates.map(mn).filter($n).join(` ${t} `);return`(${n})`}function mn(e){const t=Object.entries(e).filter((([e,t])=>e!=="term"&&e!=="bbox"&&!!t)).reduce(((e,[t,n])=>{let r;if(typeof n==="string"){r=wn(t,n)}else if(Array.isArray(n)){r=yn(t,n)}else if(gn(n)){r=bn(t,n)}else{r=vn(t,n)}e.push(r);return e}),[]).join(" AND ");return`(${t})`}function gn(e){return Number.isInteger(e.from)&&Number.isInteger(e.to)}function bn(e,t){return`${e} BETWEEN ${t.from} AND ${t.to}`}function wn(e,t){return`${e}=${Dn(t)}`}function yn(e,t){const n=t.map(Dn);return`${e} IN (${n.join(", ")})`}function vn(e,t){const n=On(e,t.any);const r=kn(e,t.all);const i=Sn(e,t.not);return[n,r,i].filter((e=>!!e)).join(" AND ")}function On(e,t){let n;if(Array.isArray(t)){const r=t.map(Dn);n=`${e} IN (${r.join(", ")})`}else if(t){n=wn(e,t)}return n}function kn(e,t){let n;if(Array.isArray(t)){n=t.map((t=>wn(e,t))).join(" AND ")}else if(t){n=wn(e,t)}return n}function Sn(e,t){let n;if(t){const r=Array.isArray(t)?t:[t];const i=r.map(Dn);n=`${e} NOT IN (${i.join(", ")})`}return n}function Dn(e){const t=/\s/;return t.test(e)?`'${e}'`:e}function $n(e){return e!=="()"}function En(e){const t=jt("term",e.filters);return t===null||t===void 0?void 0:t.term}function An(e){const{sortField:t,sortOrder:n}=e;let r;if(t){r=n==="desc"?`-properties.${t}`:`properties.${t}`}return r}function xn(e,t){const r=hn(e);const i=n(t,"requestOptions.authentication.token");const s=t.num;const o=t.start;const a=En(e);const c=An(t);const u=pn(e);return{filter:r,token:i,limit:s,startindex:o,q:a,sortBy:c,bbox:u}}async function jn(e,t){const n=`${sn(e,t)}/items`;const r=xn(e,t);const i=await an(n,r,t);return ln(i,e,t)}async function Tn(e,t){var n;return((n=t.aggFields)===null||n===void 0?void 0:n.length)?cn(e,t):jn(e,t)}async function Nn(e,t){if(!t.requestOptions){throw new _e("portalSearchGroups","options.requestOptions is required.")}e.filters=e.filters.map((e=>{e.predicates=e.predicates.map(Tt);return e}));const n=Nt(e);const r=["num","sortField","sortOrder","include","start","requestOptions"];r.forEach((e=>{if(t.hasOwnProperty(e)){n[e]=t[e]}}));if(t.requestOptions.authentication){n.authentication=t.requestOptions.authentication}else{n.portal=t.requestOptions.portal}return Rn(n)}async function Rn(e){const t=await se(e);const n=t=>Pn(t,e.include,e.requestOptions);const r=await Promise.all(t.results.map(n));return{total:t.total,results:r,hasNext:t.nextStart>-1,next:Et(e,t.nextStart,t.total,Rn)}}async function Pn(e,t=[],n){return Ln(e,t,n)}const qn=e=>{const{data:t,stack:n,requestOptions:r}=e;const i=n.start("enrichUserOrg");const s=Object.assign(Object.assign({},r),{portal:`${de(r.portal)}/sharing/rest`});return Ke(t.user.orgId,s).then((e=>{n.finish(i);return{data:Object.assign(Object.assign({},t),{org:e}),stack:n,requestOptions:r}})).catch((t=>In(t,e,i)))};const In=(e,t,n)=>{const{data:r,stack:i,requestOptions:s}=t;i.finish(n,{error:e});return{data:Object.assign(Object.assign({},r),{errors:it(e,r.errors)}),stack:i,requestOptions:s}};const Mn={org:qn};function _n(e,t,n){const r=t.reduce(((e,t)=>{const n=Mn[t];n&&e.push(n);return e}),[]);const i=p(r);return i({data:{user:e},stack:new He,requestOptions:n}).then((e=>e.data))}async function Cn(e,t,r){const i={access:e.access,id:e.username,type:"User",name:e.fullName,owner:e.username,summary:e.description,createdDate:new Date(e.created),createdDateSource:"user.created",updatedDate:new Date(e.modified),updatedDateSource:"user.modified",family:"people",links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}};const s=["org.name AS orgName"];t=[...s,...t].filter(a);const o=t.map(at);const c=h("enrichment",o).filter(a);let u={};if(c.length){u=await _n(e,c,r)}o.forEach((e=>{i[e.prop]=n(u,e.path)}));const f=r.authentication.token;i.links.thumbnail=xt(r.portal,e,f);i.links.self=ge(i.id,r);i.links.siteRelative=`/people/${i.id}`;return i}async function Un(e,t){if(!t.requestOptions){throw new _e("portalSearchUsers","requestOptions: IHubRequestOptions is required.")}if(!t.requestOptions.authentication){throw new _e("portalSearchUsers","requestOptions must pass authentication.")}e.filters=e.filters.map((e=>{e.predicates=e.predicates.map(Tt);return e}));const n=Nt(e);const r=["num","sortField","sortOrder","include","start","requestOptions"];r.forEach((e=>{if(t.hasOwnProperty(e)){n[e]=t[e]}}));n.authentication=t.requestOptions.authentication;return Gn(n)}async function Gn(e){const t=await ce(e);const n=t=>Wn(t,e.include,e.requestOptions);const r=await Promise.all(t.results.map(n));return{total:t.total,results:r,hasNext:t.nextStart>-1,next:Et(e,t.nextStart,t.total,Gn)}}async function Wn(e,t=[],n){return Cn(e,t,n)}async function Fn(e,t){if(!e){throw new _e("hubSearch","Query is required.")}if(!Array.isArray(e.filters)){throw new _e("hubSearch","Query must have a filters array.")}if(!e.filters.length&&!e.collection){throw new _e("hubSearch","Query must contain at least one Filter or a collection.")}if(!t.requestOptions){throw new _e("hubSearch","requestOptions: IHubRequestOptions is required.")}if(!t.include){t.include=[]}const r=e.targetEntity;const{requestOptions:i}=t,o=b(t,["requestOptions"]);const a=s(o);a.requestOptions=i;a.api=Wt(r,a);const c={arcgis:{item:Vt,group:Nn,user:Un},"arcgis-hub":{item:Tn}};const u=n(c,`${a.api.type}.${r}`);if(!u){throw new _e(`hubSearch`,`Search via "${r}" filter against "${a.api.type}" api is not implemented. Please ensure "targetEntity" is defined on the query.`)}return u(s(e),a)}async function Ln(e,t,r){const i={access:e.access,id:e.id,type:"Group",name:e.title,owner:e.owner,summary:e.snippet||e.description,createdDate:new Date(e.created),createdDateSource:"group.created",updatedDate:new Date(e.modified),updatedDateSource:"group.modified",family:"team",links:{self:"not-implemented",siteRelative:"not-implemented",thumbnail:"not-implemented"}};i.isSharedUpdate=(e.capabilities||[]).includes("updateitemcontrol");i.membershipAccess=e.membershipAccess;i.isOpenData=!!e.isOpenData;const s=[];t=[...s,...t].filter(a);const o=t.map(at);const c=h("enrichment",o).filter(a);let u={};if(c.length){u=await Ot(e,c,r)}o.forEach((e=>{i[e.prop]=n(u,e.path)}));i.links.thumbnail=At(r.portal,e);i.links.self=me(i.id,r);i.links.siteRelative=`/teams/${i.id}`;return i}const Hn=":host{position:absolute;width:300px;background-color:white;border:1px solid #ccc;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);padding:5px}";var Jn=function(e,t){return e.reduce((function(e,n){(e[n[t]]=e[n[t]]||[]).push(n);return e}),{})};const Kn=class{constructor(t){e(this,t);this.term=undefined;this.suggestions=[];this.sections={};this.loading=true}async fetchSuggestions(e){const t={site:"https://opendata.dc.gov",requestOptions:{hubApiUrl:"https://hub.arcgis.com"}};const n=await Fn({targetEntity:"item",filters:[{predicates:[{term:e}]}]},t);this.loading=true;const r=n.results;this.sections=Jn(r,"family");console.debug("Results",n,this.sections);this.loading=false}componentWillLoad(){this.fetchSuggestions(this.term)}render(){return t("div",null,this.loading?this.renderLoading():null,Object.keys(this.sections).map((e=>t("hub-autosuggest-section",{name:e,data:this.sections[e]}))))}renderLoading(){return t("em",null,"loading...")}static get watchers(){return{term:["fetchSuggestions"]}}};Kn.style=Hn;export{Kn as hub_autosuggest};
//# sourceMappingURL=p-ab8d611e.entry.js.map